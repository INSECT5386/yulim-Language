import json

# nukil_dict.json 불러오기
with open("nukil_dict.json", "r", encoding="utf-8") as f:
    nukil_dict = json.load(f)

# 단어 찾기
def get_word(meaning, pos=None):
    for k, v in nukil_dict.items():
        if meaning in v.get("뜻", ""):
            if pos is None or v.get("품사") == pos:
                return k
    return None

# 동사 어간 처리 및 시제 변형
def get_verb_form(verb_ko, tense="진행"):
    verb_nu = get_word(verb_ko, pos="동사")
    if tense == "평문":
        return verb_nu or verb_ko  # 평문은 기본형 그대로
    if verb_nu and "변형" in nukil_dict[verb_nu]:
        forms = nukil_dict[verb_nu]["변형"]
        tense_map = {"과거":"과거", "미래":"미래", "진행":"진행", "완료":"완료"}
        return forms.get(tense_map.get(tense, "진행"), list(forms.values())[0])
    return verb_nu or verb_ko

# 조사 자동
def get_particle(obj_ko):
    place_words = ["도시","마을","집","학교","시장","가게"]
    return "kiro" if obj_ko in place_words else "rul"

def get_korean_particle(obj_ko):
    place_words = ["도시","마을","집","학교","시장","가게"]
    return "에" if obj_ko in place_words else "을"

def get_korean_ending(verb, tense="진행"):
    verb_stem = strip_verb_infinitive(verb)
    
    if tense == "평문":
        return verb  # 평문은 '먹다', '가다' 그대로 붙이기
    
    # 불규칙 처리 예: 가다
    if verb_stem == "가":
        endings = {
            "진행": "가고 있다",
            "과거": "갔다",
            "미래": "갈 것이다",
            "완료": "간 상태이다"
        }
        return endings.get(tense, "")
    
    endings = {
        "진행": verb_stem + "고 있다",
        "과거": verb_stem + "었다",
        "미래": verb_stem + "을 것이다",
        "완료": verb_stem + "은 상태이다"
    }
    return endings.get(tense, "")


def strip_verb_infinitive(verb_ko):
    return verb_ko[:-1] if verb_ko.endswith("다") else verb_ko

# 문장 생성
def generate_sentence_natural(subject, obj, verb, tense="진행"):
    subj_nu = get_word(subject, pos="대명사") or "mimaio"
    obj_nu = get_word(obj, pos="명사") or obj
    verb_nu = get_verb_form(verb, tense)
    particle_nu = get_particle(obj)
    
    particle_ko = get_korean_particle(obj)
    ending_ko = get_korean_ending(verb, tense)
    
    ko_sentence = f"{subject} {obj}{particle_ko} {ending_ko}"
    nu_sentence = f"{subj_nu} ji {obj_nu}-{particle_nu} {verb_nu}"
    
    return ko_sentence, nu_sentence

# 예제
examples = [
    ("나", "밥", "먹다"),
    ("너", "밥", "먹다"),
    ("그녀", "밥", "먹다"),
    ("그들", "밥", "먹다"),
    ("그", "밥", "먹다"),
    ("나", "도시", "가다"),
    ("나", "마을", "가다"),
    ("그", "마을", "가다"),
    ("그", "도시", "가다"),
    ("그녀", "마을", "가다"),
    ("그녀", "도시", "가다"),
    ("그들", "마을", "가다"),
    ("그들", "마을", "가다"),
    ("나", "학교", "가다"),
    ("나", "시장", "가다"),
    ("그", "학교", "가다"),
    ("그", "시장", "가다"),
    ("그녀", "학교", "가다"),
    ("그녀", "시장", "가다"),
    ("그들", "학교", "가다"),
    ("그들", "시장", "가다"),
    ("그것", "시장", "가다"),
    ("나", "물건", "고치다"),
    ("그", "물건", "고치다"),
    ("그들", "물건", "고치다"),
    ("그녀", "물건", "고치다"),
    ("그것", "물건", "고치다"),
    ("나", "책", "읽다"),
    ("나", "책", "쓰다"),
    ("그녀", "책", "읽다"),
    ("우리", "학교", "가다"),
    ("그들", "오늘", "죽다"),
    ("그들", "내일", "죽다"),
    ("그들", "어제", "죽다"),
    ("나", "오늘", "죽다"),
    ("나", "어제", "죽다"),
    ("나", "내일", "죽다"),
    ("그", "우주", "가다"),
    ("그", "하늘", "가다"),
    ("그녀", "우주", "가다"),
    ("그들", "우주", "가다"),
    ("그것", "우주", "가다"),
    ("나", "달", "가다"),
    ("그", "달", "가다"),
    ("그녀", "달", "가다"),
    ("그들", "달", "가다"),
    ("그것", "달", "가다"),
    ("그", "우주", "보다"),
    ("그", "하늘", "보다"),
    ("그녀", "우주", "보다"),
    ("그들", "우주", "보다"),
    ("그것", "우주", "보다"),
    ("나", "달", "보다"),
    ("그", "달", "보다"),
    ("그녀", "달", "보다"),
    ("그들", "달", "보다"),
    ("그것", "달", "보다"),
    ("너", "밥", "먹다"),
    ("그", "밥", "먹다"),
    ("우리", "밥", "먹다"),
    ("그녀", "밥", "먹다"),
    ("그들", "밥", "먹다"),
    ("나", "집", "가다"),
    ("너", "집", "가다"),
    ("그", "집", "가다"),
    ("그녀", "집", "가다"),
    ("그들", "집", "가다"),
    ("나", "건물", "가다"),
    ("너", "건물", "가다"),
    ("그", "건물", "가다"),
    ("그녀", "건물", "가다"),
    ("그들", "건물", "가다"),
    ("우리", "건물", "가다"),
    ("나", "고향", "가다"),
    ("그", "고향", "가다"),
    ("그녀", "고향", "가다"),
    ("그들", "고향", "가다"),
    ("나", "학교", "가다"),
    ("너", "학교", "가다"),
    ("그", "학교", "가다"),
    ("그녀", "학교", "가다"),
    ("그들", "학교", "가다"),
    ("우리", "학교", "가다"),
    ("나", "시장", "가다"),
    ("너", "시장", "가다"),
    ("그", "시장", "가다"),
    ("그녀", "시장", "가다"),
    ("그들", "시장", "가다"),
    ("우리", "시장", "가다"),
    ("나", "가게", "가다"),
    ("그", "가게", "가다"),
    ("그녀", "가게", "가다"),
    ("그들", "가게", "가다"),
    ("나", "병원", "가다"),
    ("그", "병원", "가다"),
    ("그녀", "병원", "가다"),
    ("그들", "병원", "가다"),
    ("나", "물건", "고치다"),
    ("너", "물건", "고치다"),
    ("그", "물건", "고치다"),
    ("그녀", "물건", "고치다"),
    ("그들", "물건", "고치다"),
    ("나", "책", "읽다"),
    ("너", "책", "읽다"),
    ("그", "책", "읽다"),
    ("그녀", "책", "읽다"),
    ("그들", "책", "읽다"),
    ("우리", "책", "읽다"),
    ("나", "책", "쓰다"),
    ("너", "책", "쓰다"),
    ("그", "책", "쓰다"),
    ("그녀", "책", "쓰다"),
    ("그들", "책", "쓰다"),
    ("나", "불", "보다"),
    ("그", "불", "보다"),
    ("그녀", "불", "보다"),
    ("그들", "불", "보다"),
    ("나", "물", "보다"),
    ("그", "물", "보다"),
    ("그녀", "물", "보다"),
    ("그들", "물", "보다"),
    ("나", "땅", "보다"),
    ("그", "땅", "보다"),
    ("그녀", "땅", "보다"),
    ("그들", "땅", "보다"),
    ("나", "하늘", "보다"),
    ("그", "하늘", "보다"),
    ("그녀", "하늘", "보다"),
    ("그들", "하늘", "보다"),
    ("나", "우주", "보다"),
    ("그", "우주", "보다"),
    ("그녀", "우주", "보다"),
    ("그들", "우주", "보다"),
    ("나", "태양", "보다"),
    ("그", "태양", "보다"),
    ("그녀", "태양", "보다"),
    ("그들", "태양", "보다"),
    ("나", "달", "보다"),
    ("그", "달", "보다"),
    ("그녀", "달", "보다"),
    ("그들", "달", "보다"),
    ("나", "바람", "느끼다"),
    ("그", "바람", "느끼다"),
    ("그녀", "바람", "느끼다"),
    ("그들", "바람", "느끼다"),
    ("나", "물", "느끼다"),
    ("그", "물", "느끼다"),
    ("그녀", "물", "느끼다"),
    ("그들", "물", "느끼다"),
    ("나", "불", "느끼다"),
    ("그", "불", "느끼다"),
    ("그녀", "불", "느끼다"),
    ("그들", "불", "느끼다"),
    ("나", "흙", "느끼다"),
    ("그", "흙", "느끼다"),
    ("그녀", "흙", "느끼다"),
    ("그들", "흙", "느끼다"),
    ("나", "손", "사용하다"),
    ("그", "손", "사용하다"),
    ("그녀", "손", "사용하다"),
    ("그들", "손", "사용하다"),
    ("나", "발", "사용하다"),
    ("그", "발", "사용하다"),
    ("그녀", "발", "사용하다"),
    ("그들", "발", "사용하다"),
    ("나", "눈", "보다"),
    ("그", "눈", "보다"),
    ("그녀", "눈", "보다"),
    ("그들", "눈", "보다"),
    ("나", "아이", "돌보다"),
    ("그", "아이", "돌보다"),
    ("그녀", "아이", "돌보다"),
    ("그들", "아이", "돌보다"),
    ("나", "친구", "만나다"),
    ("그", "친구", "만나다"),
    ("그녀", "친구", "만나다"),
    ("그들", "친구", "만나다"),
    ("우리", "친구", "만나다"),
    ("나", "가족", "만나다"),
    ("그", "가족", "만나다"),
    ("그녀", "가족", "만나다"),
    ("그들", "가족", "만나다"),
    ("우리", "가족", "만나다"),
    ("나", "조부모", "만나다"),
    ("그", "조부모", "만나다"),
    ("그녀", "조부모", "만나다"),
    ("그들", "조부모", "만나다"),
    ("나", "형제", "만나다"),
    ("그", "형제", "만나다"),
    ("그녀", "형제", "만나다"),
    ("그들", "형제", "만나다"),
    ("나", "연인", "만나다"),
    ("그", "연인", "만나다"),
    ("그녀", "연인", "만나다"),
    ("그들", "연인", "만나다"),
    ("나", "학교", "읽다"),
    ("그", "학교", "읽다"),
    ("그녀", "학교", "읽다"),
    ("그들", "학교", "읽다"),
    ("우리", "학교", "읽다"),
    ("너", "학교", "가다"),
    ("너", "시장", "가다"),
    ("너", "마을", "가다"),
    ("너", "도시", "가다"),
    ("너", "달", "가다"),
    ("너", "우주", "가다"),
    ("너", "하늘", "가다"),
    ("너", "책", "읽다"),
    ("너", "책", "쓰다"),
    ("너", "물건", "고치다"),
    ("너", "밥", "먹다"),
    ("너", "밥", "마시다"),
    ("너", "물건", "사용하다"),
    ("너", "학교", "보다"),
    ("너", "시장", "보다"),
    ("너", "마을", "보다"),
    ("너", "도시", "보다"),
    ("너", "달", "보다"),
    ("너", "우주", "보다"),
    ("너", "하늘", "보다"),
    ("너", "책", "읽다"),
    ("너", "책", "쓰다"),
    ("너", "물건", "고치다"),
    ("너", "밥", "먹다"),
    ("너", "밥", "마시다"),
    ("너", "물건", "사용하다"),
    ("그녀", "학교", "보다"),
    ("그녀", "시장", "보다"),
    ("그녀", "마을", "보다"),
    ("그녀", "도시", "보다"),
    ("그녀", "달", "보다"),
    ("그녀", "우주", "보다"),
    ("그녀", "하늘", "보다"),
    ("그녀", "책", "읽다"),
    ("그녀", "책", "쓰다"),
    ("그녀", "물건", "고치다"),
    ("그녀", "밥", "먹다"),
    ("그녀", "밥", "마시다"),
    ("그녀", "물건", "사용하다"),
    ("그", "학교", "보다"),
    ("그", "시장", "보다"),
    ("그", "마을", "보다"),
    ("그", "도시", "보다"),
    ("그", "달", "보다"),
    ("그", "우주", "보다"),
    ("그", "하늘", "보다"),
    ("그", "책", "읽다"),
    ("그", "책", "쓰다"),
    ("그", "물건", "고치다"),
    ("그", "밥", "먹다"),
    ("그", "밥", "마시다"),
    ("그", "물건", "사용하다"),
    ("그들", "학교", "보다"),
    ("그들", "시장", "보다"),
    ("그들", "마을", "보다"),
    ("그들", "도시", "보다"),
    ("그들", "달", "보다"),
    ("그들", "우주", "보다"),
    ("그들", "하늘", "보다"),
    ("그들", "책", "읽다"),
    ("그들", "책", "쓰다"),
    ("그들", "물건", "고치다"),
    ("그들", "밥", "먹다"),
    ("그들", "밥", "마시다"),
    ("그들", "물건", "사용하다"),
    ("우리", "학교", "보다"),
    ("우리", "시장", "보다"),
    ("우리", "마을", "보다"),
    ("우리", "도시", "보다"),
    ("우리", "달", "보다"),
    ("우리", "우주", "보다"),
    ("우리", "하늘", "보다"),
    ("우리", "책", "읽다"),
    ("우리", "책", "쓰다"),
    ("우리", "물건", "고치다"),
    ("우리", "밥", "먹다"),
    ("우리", "밥", "마시다"),
    ("우리", "물건", "사용하다")
]

# 시제 리스트 평문 포함
tenses = ["평문", "진행", "과거", "미래", "완료"]

# JSONL 생성
with open("auto_examples_chatstyle.jsonl", "w", encoding="utf-8") as f:
    for s, o, v in examples:
        for t in tenses:
            ko, nu = generate_sentence_natural(s, o, v, tense=t)
            
            item1 = {
                "input": f"nukil어로 '{ko}'가 무슨 뜻인가요?",
                "output": f"nukil어로 '{ko}'는 '{nu}' 입니다!",
                "meta": {"형태": "ko2nu"}
            }
            f.write(json.dumps(item1, ensure_ascii=False) + "\n")
            
            item2 = {
                "input": f"한국어로 '{nu}'는 무슨 뜻인가요?",
                "output": f"한국어로 '{nu}'는 '{ko}' 입니다!",
                "meta": {"형태": "nu2ko"}
            }
            f.write(json.dumps(item2, ensure_ascii=False) + "\n")

print("JSONL 예문 생성 완료! 🎉")
